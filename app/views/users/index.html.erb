<div class="mb-3 flex flex-col items-center space-y-2">
  <input type="text" id="search" class="form-control p-2 rounded-lg border border-gray-300" placeholder="Kullanıcı Ara..."></input>
  <button id="clearSearch" class="btn btn-secondary mt-2 p-2 rounded-lg"> <i class="fas fa-solid fa-magnifying-glass text-gray-400 mr-2"></i> </button>
</div>



<% if flash[:alert] %>
  <p class="text-red-500"><%= flash[:alert] %></p>
<% end %>


<div class="user-list flex flex-col items-center space-y-4">
<% @users.each do |user| %>
  <div class="user flex flex-col items-center p-4 bg-gray-200 border border-gray-300 rounded-lg w-80 cursor-pointer" data-user-id="<%= user['id'] %>">
    <a href="<%= user_path(user['id']) %>" class="user-link flex flex-col items-center">
      <div class="user-photo mb-4">
        <% if user['id'].present? %>
          <% photo_response = HTTParty.get("https://picsum.photos/id/#{user['id']}/info") %>
          <% if photo_response.code == 200 %>
            <% photo_data = JSON.parse(photo_response.body) %>
            <img src="<%= photo_data['download_url'] %>" alt="<%= user['name'] %>" class="w-24 h-24 object-cover rounded-full border-2 border-gray-300">
          <% end %>
        <% end %>
      </div>
      <div class="user-details text-center mb-4">
        <h3 class="text-xl font-semibold"><%= user['name'] %></h3>
        <p class="text-gray-600"><%= user['username'] %></p>
      </div>
      <div class="user-actions">
        <%= link_to 'Düzenle', edit_user_path(user['id']), class: 'btn btn-primary' %>
      </div>
    </a>
  </div>
<% end %>
</div>

<style>
  .user-list {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
  }
  .user {
    display: flex;
    gap: 20px;
    padding: 15px;
    background-color: #f0f0f0;
    border: 1px solid #ddd;
    border-radius: 5px;
    width: 300px; 
    cursor: pointer; 
  }
  .user-photo img {
    width: 100px; 
    height: 100px; 
    object-fit: cover;
    border-radius: 50%;
    border: 2px solid #ddd;
  }
  .user-details {
    flex: 1;
  }
  .user-actions {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const users = document.querySelectorAll('.user');

    users.forEach(function(user) {
      user.addEventListener('click', function() {
        const userId = user.dataset.userId;
        window.location.href = `/users/${userId}`;
      });
    });

    const searchInput = document.getElementById('search');
    const clearButton = document.getElementById('clearSearch');
    const magnifyingGlassIcon = clearButton.querySelector('i');

    searchInput.addEventListener('input', function() {
      const query = searchInput.value.toLowerCase();

      if (query.trim() !== '') {
        magnifyingGlassIcon.classList.remove('fa-magnifying-glass');
        magnifyingGlassIcon.classList.add('fa-times');
      } else {
        magnifyingGlassIcon.classList.remove('fa-times');
        magnifyingGlassIcon.classList.add('fa-magnifying-glass');
      }
      users.forEach(function(user) {
        const username = user.querySelector('.user-details h3').textContent.toLowerCase();
        if (username.includes(query)) {
          user.style.display = 'flex';
        } else {
          user.style.display = 'none';
        }
      });
    });

   
    clearButton.addEventListener('click', function() {
      searchInput.value = '';
      magnifyingGlassIcon.classList.remove('fa-times');
      magnifyingGlassIcon.classList.add('fa-magnifying-glass');
      users.forEach(function(user) {
        user.style.display = 'flex';
      });
    });
  });
</script>
