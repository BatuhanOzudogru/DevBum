

<h1 class="text-2xl font-bold mb-4">Kullanıcılar</h1>

<div class="mb-3 flex">
  <input type="text" id="search" class="form-input px-4 py-2 w-full mr-2 rounded border-gray-300 focus:border-indigo-500 focus:ring focus:ring-indigo-200" placeholder="Kullanıcı Ara...">
  <button id="clearSearch" class="btn btn-secondary mt-2 px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 text-gray-800">X</button>
</div>

<% if flash[:alert] %>
  <p class="text-red-500"><%= flash[:alert] %></p>
<% end %>

<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="userList">
  <% @users.each do |user| %>
    <div class="user rounded-lg shadow-md bg-white overflow-hidden hover:shadow-lg transition duration-300">
      <%= link_to user_path(user['id']), class: 'user-link block' do %>
        <div class="user-photo p-4">
          <% if user['id'].present? %>
            <% photo_response = HTTParty.get("https://picsum.photos/id/#{user['id']}/info") %>
            <% if photo_response.code == 200 %>
              <% photo_data = JSON.parse(photo_response.body) %>
              <img src="<%= photo_data['download_url'] %>" alt="<%= user['name'] %>" class="rounded-full w-24 h-24 object-cover border-2 border-gray-200">
            <% end %>
          <% end %>
        </div>
        <div class="user-details p-4">
          <h3 class="text-xl font-semibold mb-2"><%= user['name'] %></h3>
          <p class="text-gray-600">@<%= user['username'] %></p>
        </div>
        <div class="user-actions p-4">
          <%= link_to 'Düzenle', edit_user_path(user['id']), class: 'btn btn-primary px-4 py-2 rounded bg-blue-500 hover:bg-blue-600 text-white' %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>

<style>
  .user-link {
    color: inherit;
    text-decoration: none;
  }
  .user-photo img {
    width: 100px; 
    height: 100px; 
    object-fit: cover;
    border-radius: 50%;
    border: 2px solid #ddd;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const userList = document.getElementById('userList');
    const users = Array.from(userList.querySelectorAll('.user'));

    users.forEach(function(user) {
      user.addEventListener('click', function() {
        const userId = user.dataset.userId;
        window.location.href = `/users/${userId}`;
      });
    });

    const searchInput = document.getElementById('search');
    const clearButton = document.getElementById('clearSearch');

    searchInput.addEventListener('input', function() {
      const query = searchInput.value.trim().toLowerCase();

      users.forEach(function(user) {
        const username = user.querySelector('.user-details h3').textContent.toLowerCase();
        if (username.includes(query)) {
          user.style.display = 'block';
        } else {
          user.style.display = 'none';
        }
      });
    });

    clearButton.addEventListener('click', function() {
      searchInput.value = '';
      users.forEach(function(user) {
        user.style.display = 'block';
      });
    });
  });
</script>
